<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default"
  data-assets-path="./../../assets/" data-template="horizontal-menu-template-starter">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>AARO Dashboard</title>

  <meta name="description" content />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="./../../assets/img/favicon/favicon.ico" />
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" type="text/css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">



  <!-- Core CSS -->
  <link rel="stylesheet" type="text/css" href="./../../assets/vendor/css/rtl/core.css" />
  <link rel="stylesheet" type="text/css" href="./../../assets/vendor/css/rtl/theme-semi-dark.css" />
  <link rel="stylesheet" type="text/css" href="./../../assets/css/demo.css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


  <link rel='stylesheet' href="./../../assets/css/wizard/bootstrap.min.css" rel="stylesheet" />
  <link rel='stylesheet' href="./../../assets/css/wizard/paper-bootstrap-wizard.css" rel="stylesheet" />
  <link rel='stylesheet' href="./../../assets/css/wizard/themify-icons.css" rel="stylesheet">
  <!-- <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css'> -->
  <link rel="stylesheet" href="./../../assets/vendor/libs/jstree/jstree.css" />


  <!-- Helpers -->
  <script src="./../../assets/vendor/js/helpers.js" type="text/javascript"></script>



  <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js" type="text/javascript"></script>

  <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
  <link rel="stylesheet" type="text/css"
    href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css" />
  <style>
    .bg-menu-theme.menu-vertical .menu-item.active>.menu-link:not(.menu-toggle) {
      background: #005396 !important;
      box-shadow: 0px 2px 6px 0px rgba(42, 30, 179, 0.48);
      color: #fff !important;
    }

    .tab-cont {
      display: none;
      background: #ededed;
      padding: 15px;
    }

    .tab-content.curr {
      display: inherit;
    }



    .card>img {
      display: block;
      width: 100%;
      max-width: 500px;
      aspect-ratio: 4/3;
      object-fit: cover;
      object-position: 50% 50%;
      border-radius: 16px 16px 0 0;
      filter: contrast(70%);
      transition: all 0.6s cubic-bezier(0.43, 0.41, 0.22, 0.91);
    }

    .card>img:hover {
      filter: contrast(100%);
    }

    .card-content {
      display: flex;
      flex-direction: column;
      padding: 20px 15px 20px;
    }

    .card-content>p {
      margin-bottom: 10px;
    }

    .card-content>p:nth-child(1) {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 10px;
      color: #1e40af;
    }

    .wizard-card .icon-circle {
      font-size: 30px;
      text-align: center;
      
    }
    .wizard-card .icon-circle i{
      
      
      margin-top: 15px
      
    }

    .nav-pills > li > a > i {

      color: #fff;
    }
    
    .wizard-card .icon-circle i::after{
      
      color: white;
      
    }

    .nav-pills>li>a>div>i ::after {
      color: white;
    }

    .hide {
      display: none !important;
    }

    .jstree-default {
      margin-left: 100px;
    }
  </style>


</head>

<body>
  <!-- Layout wrapper -->

  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Menu -->

      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo">
          <a href="index.html" class="app-brand-link">
            <span class="app-brand-logo demo">
              <img src="./../../assets/img/branding/aaro-logo-80.png" alt width="40px" height="20px">
            </span>
            <span class="app-brand-text demo menu-text fw-bold">AARO SYSTEMS</span>
          </a>
        </div>

        <!-- <div class="menu-inner-shadow"></div> -->

        <ul class="menu-inner py-1">
          <!-- Dashboards -->
          <li class="menu-item">
            <a href="index.html" class="menu-link">
              <i class="menu-icon fas fa-home"></i>
              <div data-i18n="Dashboards">Templates</div>
              <!-- <div class="badge bg-label-primary rounded-pill ms-auto">3</div> -->
            </a>
          </li>

          <!-- Layouts -->
          <li class="menu-item">
            <a href="templates.html" class="menu-link">
              <i class="menu-icon fas fa-file-alt"></i>
              <div data-i18n="Layouts">Reports</div>
            </a>

          </li>

          <li class="menu-item active">
            <a href="uploads.html" class="menu-link">
              <i class="menu-icon fas fa-file-upload"></i>
              <div data-i18n="Layouts">V1</div>
            </a>

          </li>

        </ul>
      </aside>
      <!-- / Menu -->
      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->
        <nav
          class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
          id="layout-navbar">
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
              <i class="fas fa-bars"></i>
            </a>
          </div>

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <!-- Search -->

            <!-- /Search -->

            <ul class="navbar-nav flex-row align-items-center ms-auto">

              <!-- User -->
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../../assets/img/illustrations/card-advance-sale.png" alt class="h-auto rounded-circle" />
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="pages-account-settings-account.html">
                      <div class="d-flex">
                        <div class="flex-shrink-0 me-3">
                          <div class="avatar avatar-online">
                            <img src="../../assets/img/avatars/1.png" alt class="h-auto rounded-circle" />
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <span class="fw-semibold d-block" id="username"></span>
                          <small class="text-muted">Admin</small>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="pages-profile-user.html">
                      <i class="fas fa-user-check"></i>
                      <span class="align-middle">My Profile</span>
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="pages-account-settings-account.html">
                      <i class="fas fa-cog"></i>
                      <span class="align-middle">Settings</span>
                    </a>
                  </li>

                  <div class="dropdown-divider"></div>
              </li>
              <li>
                <a class="dropdown-item" href="pages-help-center-landing.html">
                  <i class="fas fa-life-ring"></i>
                  <span class="align-middle">Help</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="pages-faq.html">
                  <!-- <i class="fas fa-circle-question"></i> -->
                  <i class="fas fa-circle-question"></i>
                  <span class="align-middle">FAQ</span>
                </a>
              </li>

              <li>
                <div class="dropdown-divider"></div>
              </li>
              <li>
                <a class="dropdown-item" id="logoutButton">
                  <i class="fas fa-right-from-bracket"></i>
                  <span class="align-middle">Log Out</span>
                </a>
              </li>
            </ul>
            </li>
            <!--/ User -->
            </ul>
          </div>

          <!-- Search Small Screens -->
          <div class="navbar-search-wrapper search-input-wrapper d-none">
            <input type="text" class="form-control search-input container-xxl border-0" placeholder="Search..."
              aria-label="Search..." />
            <i class="ti ti-x ti-sm search-toggler cursor-pointer"></i>
          </div>
        </nav>
        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->
          <div class="container-xxl flex-grow-1 container-p-y">

            <div class="row">
              <div class="col-md-12 col-12">
                <div class="card">
                  <div class="card-header">
                    <h5>Reports</h5>
                  </div>
                  <div class="card-body">
                    <!--      Wizard container        -->

                    <div class="wizard-container">
                      <div class="card wizard-card" data-color="red" id="wizard">
                        <!--        You can switch " data-color="green" "  with one of the next bright colors: "blue", "azure", "orange", "red"       -->

                        <div class="wizard-header">
                          <h3 class="wizard-title">Welcome to AARO WORD CONNCECTOR</h3>
                          <p class="category">This information will let us know more about .</p>
                        </div>
                        <div class="wizard-navigation">
                          <div class="progress-with-circle">
                            <div class="progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="1"
                              aria-valuemax="4" style="width: 15%;"></div>
                          </div>
                          <ul>
                            <li>
                              <a href="#start" data-toggle="tab">
                                <div class="icon-circle">
                                  <i class="fa fa-arrow-right"></i>
                                </div>
                                Start
                              </a>
                            </li>
                            <li>
                              <a href="#report" data-toggle="tab">
                                <div class="icon-circle">
                                  <i class="fa fa-file-alt"></i>
                                </div>
                                Report
                              </a>
                            </li>
                            <li>
                              <a href="#format" data-toggle="tab">
                                <div class="icon-circle">
                                  <i class="fa fa-align-center"></i>
                                </div>
                                Format
                              </a>
                            </li>
                            <li>
                              <a href="#finish" data-toggle="tab">
                                <div class="icon-circle">
                                  <i class="fa fa-unlink"></i>
                                </div>
                                Finish
                              </a>
                            </li>
                          </ul>
                        </div>
                        <div class="tab-content">
                          <div class="tab-pane" id="start">
                            <div class="row">
                              <div class="col-sm-12">
                                <h5 class="info-text"> Kindly select the report you want to load on your
                                  Word Reporter</h5>
                              </div>
                              <div>
                                <h4>History</h4>
                                <table class="table">
                                  <thead>
                                    <tr>
                                      <th>id</th>
                                      <th>Report</th>
                                      <th>DateTime</th>
                                      <th>Actions</th>
                                    </tr>
                                  </thead>
                                  <tbody class="table-border-bottom-0">
                                    <tr>
                                      <td>
                                        <i class="ti ti-brand-angular ti-lg text-danger me-3"></i>
                                        <strong>1</strong>
                                      </td>
                                      <td>3 Income statement by Business Area</td>

                                      <td><span class="badge bg-label-primary me-1">01/012023 12:25:36</span>
                                      </td>
                                      <td>
                                        <div class="dropdown">
                                          <button type="button" class="btn p-0 dropdown-toggle hide-arrow"
                                            data-bs-toggle="dropdown">
                                            <i class="ti ti-dots-vertical"></i> Load
                                          </button>

                                        </div>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>
                                        <i class="ti ti-brand-react-native ti-lg text-info me-3"></i>
                                        <strong>2</strong>
                                      </td>
                                      <td>5 Consolidated balance sheet</td>
                                      <td><span class="badge bg-label-primary me-1">01/012023 12:25:40</span>
                                      </td>

                                      <td>
                                        <div class="dropdown">
                                          <button type="button" class="btn p-0 dropdown-toggle hide-arrow"
                                            data-bs-toggle="dropdown">
                                            <i class="ti ti-dots-vertical"></i>Load
                                          </button>

                                        </div>
                                      </td>
                                    </tr>

                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                          <div class="tab-pane" id="report">
                            <div id="jstree-ajax"></div>
                          </div>



                          <div class="tab-pane" id="format">
                            <h5 class="info-text">Please Select the format to load the report. </h5>
                            <div class="row">
                              <div class="col-sm-6 mb-3">
                                <label for="decimal" class="form-label">Report Name</label>
                                <input type="text" class="form-control" id="reportName" placeholder="Report Name"
                                  readonly aria-describedby="defaultFormControlHelp" required />

                              </div>
                              <div class="col-sm-6 mb-3">
                                <label for="select2Icons" class="form-label">Table Styles</label>
                                <select id="select2Icons" class="select2-icons form-select"> </select>
                              </div>
                              <div class="col-sm-6 mb-3">
                                <label for="decimal" class="form-label">Number of Decimal Places</label>
                                <input type="text" class="form-control" id="decimalPlace" placeholder="2"
                                  aria-describedby="defaultFormControlHelp" required />

                              </div>

                            </div>
                          </div>
                          <div class="tab-pane" id="finish">

                            <form action="" method="Post">
                              <div class="row">
                                <div class="col-md mb-3">
                                  <label for="decimal" class="form-label">Report Name</label>
                                  <input type="text" class="form-control" id="reportN" placeholder="Report Name"
                                    readonly aria-describedby="defaultFormControlHelp" required />

                                </div>
                                <div class="col-md mb-3">
                                  <label for="decimal" class="form-label">Report ID</label>
                                  <input type="text" class="form-control" id="reportID" placeholder="Report Name"
                                    readonly aria-describedby="defaultFormControlHelp" required />
                                </div>
                                <div class="col-md mb-3">
                                  <label for="decimal" class="form-label">Table Styles</label>
                                  <input type="text" class="form-control" id="style" placeholder="Table Styles" readonly
                                    aria-describedby="defaultFormControlHelp" required />
                                </div>
                                <div class="col-md mb-3">
                                  <label for="decimal" class="form-label">Number of Decimal Places</label>
                                  <input type="text" class="form-control" id="decimal"
                                    placeholder="Number of Decimal Places" readonly
                                    aria-describedby="defaultFormControlHelp" required />
                                </div>
                              </div>

                            </form>

                            <div class="row" id="dataAppend"></div>
                          </div>
                        </div>
                        <div class="wizard-footer">
                          <div class="pull-right">
                            <input type='button' class='btn btn-next btn-fill btn-danger btn-wd' name='next'
                              value='Next' />
                            <input type='button' class='btn btn-finish btn-fill btn-danger btn-wd hide' name='finish'
                              value='Load Report' />
                          </div>

                          <div class="pull-left">
                            <input type='button' class='btn btn-previous btn-default btn-wd' name='previous'
                              value='Previous' />
                          </div>
                          <div class="clearfix"></div>
                        </div>

                      </div>
                    </div> <!-- wizard container -->
                  </div>
                </div>
              </div>
            </div> <!-- row -->

          </div>

          <!--/ Checkout Wizard -->

          <!--/ Add New Address Modal -->
        </div>
        <!-- / Content -->

        <!-- / Content -->

        <!-- Footer -->
        <footer class="content-footer footer bg-footer-theme">
          <div class="container-xxl">
            <div
              class="footer-container d-flex align-items-center justify-content-between py-2 flex-md-row flex-column">
              <div>
                Â©
                <script>
                  document.write(new Date().getFullYear());
                </script>
                , <a href="https://www.aaro.com" target="_blank" class="fw-semibold">AARO
                  SYSTEMS</a>
              </div>

            </div>
          </div>
        </footer>
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
      </div>
      <!-- Content wrapper -->
    </div>
    <!-- / Layout page -->
  </div>

  <!-- Overlay -->
  <div class="layout-overlay layout-menu-toggle"></div>

  <!-- Drag Target Area To SlideIn Menu On Small Screens -->
  <div class="drag-target"></div>
  </div>


  <!-- Core JS -->
  <!-- build:js ./../../assets/vendor/js/core.js -->
  <script type="text/javascript" src="uploads.js"></script>
  <script type="text/javascript" src="./../../assets/vendor/libs/jquery/jquery.js"></script>
  <script type="text/javascript" src="./../../assets/vendor/libs/popper/popper.js"></script>
  <!-- <script type="text/javascript" src="./../../assets/vendor/js/bootstrap.js"></script> -->
  <script type="text/javascript" src="./../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script type="text/javascript" src="./../../assets/vendor/libs/node-waves/node-waves.js"></script>

  <script type="text/javascript" src="./../../assets/vendor/libs/hammer/hammer.js"></script>

  <script type="text/javascript" src="./../../assets/vendor/js/menu.js"></script>
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="./../../assets/js/wizard/jquery-2.2.4.min.js" type="text/javascript"></script>
  <script src="./../../assets/js/wizard/bootstrap.min.js" type="text/javascript"></script>
  <script src="./../../assets/js/wizard/jquery.bootstrap.wizard.js" type="text/javascript"></script>
  <script type="text/javascript" src="./../../assets/vendor/libs/jstree/jstree.css"></script>
  <script type="text/javascript" src="./../../assets/vendor/libs/jstree/jstree.js"></script>


  <!--  Plugin for the Wizard -->
  <!-- <script src="assets/js/demo.js" type="text/javascript"></script> -->
  <script src="./../../assets/js/wizard/paper-bootstrap-wizard.js" type="text/javascript"></script>

  <!--  More information about jquery.validate here: https://jqueryvalidation.org/	 -->
  <script src="./../../assets/js/wizard/jquery.validate.min.js" type="text/javascript"></script>

  <!-- <script type="text/javascript" src="templates.js"></script> -->
  <!-- Main JS -->
  <!-- <script type="text/javascript" src="./../../assets/js/main.js"></script> -->
  <script>
    $(document).ready(function () {
      // Initially hide the "Load Report" button
      $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        // Check if the "finish" tab-pane is active
        if ($('.tab-pane.active').attr('id') === 'finish') {
          // Remove the 'hide' class to show the "Load Report" button
          $('.btn-finish').removeClass('hide');
        } else {
          // Add the 'hide' class to hide the "Load Report" button
          $('.btn-finish').addClass('hide');
        }

        if ($('.tab-pane.active').attr('id') === 'start') {
          // Remove the 'hide' class to show the "Load Report" button
          $('.btn-previous').addClass('hide').css('btn-previous', 'display: none !important;');
        } else {
          // Add the 'hide' class to hide the "Load Report" button


          $('.btn-previous').removeClass('hide');
        }
      });


      const storedData = localStorage.getItem('node_selected');
      const data = JSON.parse(storedData);
      if (storedData) {
        const selectedNode = JSON.parse(storedData);

        // console.log( selectedNode);
        $('#reportName').val(selectedNode.text);
      }

      $("#ClearReport").click(function () {
        // Clear all items from local storage
        localStorage.clear();

        // Refresh the page
        location.reload();
      });


    });

    var theme = $('html').hasClass('light-style') ? 'default' : 'default-dark',
      ajaxTree = $('#jstree-ajax');

    async function loadJSTreeData() {

      try {
        // const token = await login(); // Call the login function
        var token = localStorage.getItem('aaroWebToken');
        console.log(token);

        // Now you have the token and can use it for subsequent API calls
        await browseWithToken(token); // Call another function that uses the token
      } catch (error) {
        console.error(error);
      }


    }

    function results(selectedNodeId, token) {
      const otherApiUrl = `https://aaro-web.test/api/v1/reports/report/${selectedNodeId}`;

      let reportId = parseInt(selectedNodeId, 10);
      if (typeof reportId === 'number' && Number.isInteger(reportId)) {
        let reports = [reportId];
        // Convert the array to a JSON string before storing it in local storage
        localStorage.setItem('all_reports', JSON.stringify(reports));

        console.log(typeof reportId)
        console.log(otherApiUrl)
        // Perform the API call using the selected node's ID
        fetch(otherApiUrl, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
            'Authorization': `Bearer ${token}`
          }
        })
          .then(response => response.json())

          .then(data => {
            console.log("Data from other API:", data);
            // Process the data from the other API as needed
            localStorage.setItem('apiData', JSON.stringify(data));
            var jstree_temp = localStorage.getItem('jstree');
            localStorage.setItem('jstree_temp', jstree_temp);
            localStorage.setItem('criteria', JSON.stringify(data.criteria));
            localStorage.removeItem('jstree');
            // Redirect to index.html

          })
          .catch(error => {
            console.error("Other API request failed:", error);
          });


      } else {

        console.log(Number.isInteger(reportId))
        console.log(otherApiUrl)
      }


    }

    function stringifySafe(obj, depth = 5) {
      const cache = new WeakSet();

      return JSON.stringify(obj, (key, value) => {
        if (typeof value === 'object' && value !== null) {
          if (cache.has(value) || depth === 0) return '[Circular]';

          cache.add(value);
        }

        return value;
      });
    }

    async function login() {
      const url = 'https://aaro-web.test/api/v1/auth/login';
      const credentials = {
        email: 'doyle.abagail@example.net',
        password: '!admin123!'
      };

      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(credentials)
      });

      if (response.ok) {
        const data = await response.json();
        const token = data.token; // Assuming the API returns the access token
        console.log(data)
        console.log(data)
        // Store the token for reuse in subsequent API calls
        localStorage.setItem('aaroWebToken', token);
        return token;
      } else {
        throw new Error('Login failed');
      }
    }

    async function browseWithToken(token) {
      const url = 'https://aaro-web.test/api/v1/reports/browse'; // Replace with the actual API endpoint

      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        // Process the response data here
        console.log('this is harry ' + stringifySafe(data));
      } else {
        console.error('API request failed');
      }
    }

    // Usage
    (async () => {
      try {
        // const token = await login();
        var token = localStorage.getItem('aaroWebToken');
        console.log(token);
        await browseWithToken(token);

        if (!token) {
          token = await login(); // Assuming login is an asynchronous function that returns a token
          localStorage.setItem('aaroWebToken', token);
        }


        ajaxTree
          .on("select_node.jstree", function (e, data) {
            // const safeJSON = stringifySafe(data, null, 2);
            // alert(safeJSON);
            // console.log("Node selected:", safeJSON);
            const selectedNode = data.node;
            console.log("Node selected:", selectedNode);
            localStorage.setItem('node_selected', JSON.stringify(selectedNode));
            results(selectedNode.id, token);
          }).jstree({
            core: {
              themes: {
                name: theme
              },
              check_callback: true,
              data: {
                url: "https://aaro-web.test/api/v1/reports/browse",
                method: 'POST',
                dataType: 'json',
                data: function (node) {
                  return {
                    id: node.id,
                    name: node.name,
                    parents: node.parents,
                    parent: node.parent,
                    _token: token
                  };
                },
                headers: {
                  'Accept': 'application/json',
                  'Authorization': `Bearer ${token}`
                }
              }
            },
            plugins: ['types', 'state'],
            types: {
              default: {
                icon: 'ti ti-folder'
              },
              html: {
                icon: 'ti ti-brand-html5 text-danger'
              },
              css: {
                icon: 'ti ti-brand-css3 text-info'
              },
              img: {
                icon: 'ti ti-photo text-success'
              },
              js: {
                icon: 'ti ti-brand-javascript text-warning'
              }
            }
          });
      } catch (error) {
        console.error(error);
      }
    })();




    // Function to make API call and populate dropdown
    async function getDimensions(dimension) {
      var tkn = localStorage.getItem('aaroWebToken');
      const url = "https://aaro-web.test/api/v1/reports/report/dimensions/" + dimension;

      const headers = {
        'Authorization': tkn,
      };

      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Authorization': `Bearer ${tkn}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        return data;
      } else {
        console.error('API request failed');
      }
    }

    async function createCheckboxes(criteria) {
      const checkboxesContainer = document.createElement('div');
      checkboxesContainer.className = 'row';

      // console.log('criteria', criteria);s

      for (const item of criteria) {
        const colDiv = document.createElement('div');
        colDiv.className = 'col-sm-6';

        const formGroupDiv = document.createElement('div');
        formGroupDiv.className = 'form-group';

        const label = document.createElement('label');
        label.className = 'form-label';

        label.appendChild(document.createTextNode(item.dimension));


        const select = document.createElement('select');
        select.className = 'form-select';
        select.name = item.dimension;
        select.id = `${item.dimension}-select`;

        const option = document.createElement('option');
        option.disabled = true;
        option.selected = true;
        option.appendChild(document.createTextNode(`- ${item.dimension} -`));
        select.appendChild(option);

        formGroupDiv.appendChild(label);
        formGroupDiv.appendChild(select);
        colDiv.appendChild(formGroupDiv);
        checkboxesContainer.appendChild(colDiv);


        console.log('dimension is' + item.dimension)
        // Populate the dropdown asynchronously
        const dimensionData = await getDimensions(item.dimension);

        if (dimensionData && dimensionData.members && Array.isArray(dimensionData.members)) {
          // If dimensionData.members is an array, use forEach
          dimensionData.members.forEach(d => {
            const option = document.createElement('option');
            option.value = d.name;
            option.textContent = d.name;
            if (d.name === item.value) {
              option.selected = true;
            }
            select.appendChild(option);
          });
        } else {
          // Handle the case when dimensionData.members is not an array (modify as needed)
          console.error('Dimension members data is not an array:', dimensionData);
        }
      }

      return checkboxesContainer;
    }

    async function main() {
      const container = document.querySelector('#format'); // Select the #format tab-pane
      const criteriaDataString = localStorage.getItem('criteria');
      const criteria = JSON.parse(criteriaDataString);
      console.log('criteria', criteria);
      // Create checkboxes and append them to the container
      if (criteria) {
        const checkboxes = await createCheckboxes(criteria);
        container.appendChild(checkboxes);
      }
    }

    main();


    async function fetchTableStyles() {
      var token = localStorage.getItem('aaroWebToken');
      try {
        const url = 'https://aaro-web.test/api/v1/reports/table_styles';
        const response = await $.ajax({
          url: url,
          type: 'GET',
          headers: {
            'Accept': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          dataType: 'json'
        });

        console.log(response);
        return response;
      } catch (error) {
        console.error('Error fetching table styles:', error);
        throw error;
      }
    }


    window.addEventListener("load", async () => {

      loadJSTreeData();

      const selectElement = document.getElementById("select2Icons");

      try {
        const response = await fetchTableStyles();

        console.log('Response:', response);

        const tableStylesArray = Object.entries(response).map(([slug, name]) => ({ slug, name }));
        // Group the table styles
        const groupedOptions = {
          "Table Grid": [],
          "Plain Table": [],
          "Grid Table 1 Light": [],
          "Grid Table 2": [],
          "Grid Table 3": [],
          "Grid Table 4": [],
          "Grid Table 5 Dark": [],
          "Grid Table 6 Colorful": [],
          "Grid Table 7 Colorful": []
          // Add more groups as needed
        };

        tableStylesArray.forEach((style) => {
          if (style.name.startsWith("Table Grid")) {
            groupedOptions["Table Grid"].push(style);
          } else if (style.name.startsWith("Plain Table")) {
            groupedOptions["Plain Table"].push(style);
          } else if (style.name.startsWith("Grid Table 1 Light")) {
            groupedOptions["Grid Table 1 Light"].push(style);
          } else if (style.name.startsWith("Grid Table 2")) {
            groupedOptions["Grid Table 2"].push(style);
          } else if (style.name.startsWith("Grid Table 3")) {
            groupedOptions["Grid Table 3"].push(style);
          } else if (style.name.startsWith("Grid Table 4")) {
            groupedOptions["Grid Table 4"].push(style);
          } else if (style.name.startsWith("Grid Table 5 Dark")) {
            groupedOptions["Grid Table 5 Dark"].push(style);
          } else if (style.name.startsWith("Grid Table 6 Colorful")) {
            groupedOptions["Grid Table 6 Colorful"].push(style);
          } else if (style.name.startsWith("Grid Table 7 Colorful")) {
            groupedOptions["Grid Table 7 Colorful"].push(style);
          }
          // Add more conditions to group the table styles based on your desired logic
        });

        // Generate the select options dynamically
        for (const groupName in groupedOptions) {
          const group = document.createElement("optgroup");
          group.label = groupName;
          groupedOptions[groupName].forEach((optionValue) => {
            const option = document.createElement("option");
            option.value = optionValue.slug; // Use the 'slug' property as the option value
            option.textContent = optionValue.name; // Use the 'name' property as the option text
            group.appendChild(option);
          });
          selectElement.appendChild(group);
        }
      } catch (error) {
        console.error('Error loading table styles:', error);
      }


    });


    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      const targetTab = $(e.target).attr('href');
      if (targetTab === '#finish') {
        // Output the name of the report
        // const reportName = document.querySelector('#reportName').value;
        // Retrieve the JSON string from local storage

        // Output the selected criteria
        const selectedCriteria = [];
        const criteria = JSON.parse(localStorage.getItem('criteria'));
        const container = document.querySelector('#finish');

        console.log(criteria)
        for (const item of criteria) {
          // Create a div to contain the label and read-only text box
          const divContainer = document.createElement('div');
          divContainer.className = 'form-group';

          // Create a label for the dimension
          const label = document.createElement('label');
          label.appendChild(document.createTextNode(item.dimension));

          // Create a read-only text box for the selected value
          const readOnlyTextBox = document.createElement('input');
          readOnlyTextBox.type = 'text';
          readOnlyTextBox.className = 'form-control';
          readOnlyTextBox.value = item.value;
          readOnlyTextBox.readOnly = true;

          // Append the label and read-only text box to the container div
          divContainer.appendChild(label);
          divContainer.appendChild(readOnlyTextBox);

          // Append the container div to the main container
          container.appendChild(divContainer);

          // Store the selected criteria
          selectedCriteria.push({
            dimension: item.dimension,
            value: item.value
          });
        }

        const nodeSelectedString = localStorage.getItem('node_selected');
        // Parse the JSON string to get an object
        const nodeSelectedObject = JSON.parse(nodeSelectedString);
        // Access the 'id' property
        const reportName = nodeSelectedObject.text;
        const reportID = nodeSelectedObject.id;

        console.log('Report Name:', reportName);

        const tableStyles = document.querySelector('#select2Icons').value;
        const decimalPlaces = document.querySelector('#decimalPlace').value;
        $('#reportN').val(reportName);
        $('#reportID').val(reportID);
        $('#style').val(tableStyles);
        $('#decimal').val(decimalPlaces);


        console.log('Selected Criteria:', selectedCriteria);

        // Now you can use the reportName and selectedCriteria to make the API call or perform any other actions
      }
    });


    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      const targetTab = $(e.target).attr('href');
      if (targetTab === '#format') {

        const nodeSelectedString = localStorage.getItem('node_selected');
        // Parse the JSON string to get an object
        const nodeSelectedObject = JSON.parse(nodeSelectedString);
        // Access the 'id' property
        const reportName = nodeSelectedObject.text;
        console.log('Report Name:', reportName);
        $('#reportName').val(reportName);



        // Now you can use the reportName and selectedCriteria to make the API call or perform any other actions
      }
    });

  </script>
</body>

</html>